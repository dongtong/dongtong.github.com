
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Nodejs 介绍 - Dong Way</title>
  <meta name="author" content="Dong">

  
  <meta name="description" content="开始 首先通过一个实例看看nodejs执行程序: 1
2
3
4
5
6
7
8
var fs = require(&quot;fs&quot;);//包含file system 模块
console.log(&quot;开始读取文件...&quot;);//类似于浏览器环境
// &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.dongjinhu.com/blog/2012/09/16/introduce-nodejs">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/style.css" media="screen, projection" rel="stylesheet" type="text/css">

  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dong Way" type="application/atom+xml">
  
  

</head>

<body   >
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">Dong Way</a>

      <div class="nav-collapse">
        <ul class="nav">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>


        <ul class="nav pull-right" data-subscription="rss email">
          <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
            <li><a href="chinatea.guy@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="http://google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:www.dongjinhu.com" />
              <input class="search-query" type="text" name="q" results="0" placeholder="Search"/>
            </fieldset>
          </form>
        
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      
<article class="hentry span9" role="article">

  
  <header class="page-header">
    
      <h1 class="entry-title">Nodejs 介绍</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-16T19:51:00+08:00" pubdate data-updated="true">Sep 16<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>开始</h2>

<p>首先通过一个实例看看nodejs执行程序:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span><span class="c1">//包含file system 模块</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;开始读取文件...&quot;</span><span class="p">);</span><span class="c1">//类似于浏览器环境</span>
</span><span class='line'><span class="c1">//第一个参数是文件地址，第二个是callback</span>
</span><span class='line'><span class="c1">//callback第一个参数是error,第二个参数文件的内容</span>
</span><span class='line'><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;文件内容为:&quot;</span><span class="o">+</span><span class="nx">data</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;读取文件结束&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>你认为执行的结果是不是应该是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">开始读取文件</span><span class="p">...</span>
</span><span class='line'><span class="c1">//文件内容</span>
</span><span class='line'><span class="err">读取文件结束</span>
</span></code></pre></td></tr></table></div></figure>


<p>实际上是:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">开始读取文件</span><span class="p">...</span>
</span><span class='line'><span class="err">读取文件结束</span>
</span><span class='line'><span class="c1">//文件内容</span>
</span></code></pre></td></tr></table></div></figure>


<p>原因是Nodejs是非阻塞执行地，一般语言都是一行一行阻塞执行代码。
非阻塞执行是Nodejs一个特性。</p>

<!--More-->


<h2>文件操作</h2>

<p>下面使用fs模块对文件进行读写操作。上面已经介绍过异步读取文件。下面介绍同步读取文件。
一般情况下，程序在运行时，先要读取必要的配置文件，然后在执行程序，这时就需要同步(阻塞)
读取文件内容。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;同步读取文件...&quot;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;文件内容:&quot;</span><span class="o">+</span><span class="nx">content</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;读取文件内容结束&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>如何处理JSON数据?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;读取配置文件&quot;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;配置文件内容:\n&quot;</span><span class="o">+</span><span class="nx">content</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;读取配置文件结束&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span><span class="c1">//JSON类内置在Node.js中</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">config</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">config</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>读取config.json内容为:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;api_key&quot;</span><span class="o">:</span> <span class="s2">&quot;Wzs123CDW&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上代码执行的结果:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">name</span><span class="o">:</span><span class="nx">foo</span>
</span><span class='line'><span class="nx">api_key</span><span class="o">:</span><span class="nx">Wzs123CDW</span>
</span><span class='line'><span class="nx">version</span><span class="o">:</span><span class="mf">1.0</span>
</span></code></pre></td></tr></table></div></figure>


<p>下面介绍使用fs模块同步写文件:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;同步写入文件开始...&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s2">&quot;write_sync.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;node.js write content synchronous!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;写文件结束&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>一般情况下都使用异步写入文件，比如程序在运行时，异步写入log而不使应用程序变缓慢。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;异步写入文件...&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//error是当找不到文件，或者写文件无法返回之类的错误。</span>
</span><span class='line'><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="s2">&quot;write_async.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;write asynchronous!&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;正在异步写入----&gt;&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;结束&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>执行信息:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">异步写入文件</span><span class="p">...</span>
</span><span class='line'><span class="err">结束</span>
</span><span class='line'><span class="err">正在异步写入</span><span class="o">----&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>接下来介绍监视文件是否被修改。一般情况我们有这样的需求，就是监视配置文件被更新了，并且被
谁更新了等等。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;监视文件开始...&quot;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">));</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;配置文件初始内容为:\n&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">config</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">config</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">fs</span><span class="p">.</span><span class="nx">watchFile</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">current_content</span><span class="p">,</span> <span class="nx">prev_content</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;文件内容改变&gt;&gt;&gt;&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;新的文件内容为:\n&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">config</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">config</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>先修改config.json的内容，然后观察控制台会发现config.json内容改变时，控制台将显示最新的
内容。</p>

<p>接下来介绍如何使用Node.js创建一个简单的Http Server来接受和处理客户端浏览器的请求。
在开始构建这个Http Server前，先查看一下官方的文档，找到http这个模块，里面提供给详细的方法
调用以及说明。下面开始实现:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//加载需要的模块</span>
</span><span class='line'><span class="c1">//定义http server的host和port</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">host</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="s2">&quot;8888&quot;</span><span class="p">;</span>
</span><span class='line'><span class="c1">//创建server</span>
</span><span class='line'><span class="c1">//第一个参数是接受客户端的请求，</span>
</span><span class='line'><span class="c1">//第二个参数是http server的响应</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;接受请求:&quot;</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//定义响应的类型</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="s2">&quot;200&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="s2">&quot;text/plain&quot;</span><span class="p">});</span>
</span><span class='line'>  <span class="c1">//response.write();</span>
</span><span class='line'>  <span class="c1">//结束响应</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;Hello Node.js&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="c1">//侦听一个端口</span>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;侦听&quot;</span> <span class="o">+</span> <span class="nx">host</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开浏览器输入127.0.0.1:8888后查看控制台输出:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">侦听</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="o">:</span><span class="mi">8888</span>
</span><span class='line'><span class="err">接受请求</span><span class="o">:</span><span class="err">/</span>
</span><span class='line'><span class="err">接受请求</span><span class="o">:</span><span class="err">/favicon.ico</span>
</span></code></pre></td></tr></table></div></figure>


<p>为什么会有两次请求？因为chrome会自动发送一个请求去获取favicon(这里使用的是chrome)。
但是如果使用的是firefox，是没有第二次请求的。接下来看看如何显示更多的信息:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">host</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="s2">&quot;8888&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;接受请求:&quot;</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s2">&quot;./public&quot;</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
</span><span class='line'>          <span class="c1">//如果文件找不到的话，显示404</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="o">:</span><span class="s2">&quot;text/plain&quot;</span><span class="p">});</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;对不起，文件不存在!&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>          <span class="c1">//显示html文件内容</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="o">:</span><span class="s2">&quot;text/html&quot;</span><span class="p">});</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;侦听&quot;</span> <span class="o">+</span> <span class="nx">host</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>下面结合config.json配置文件来动态决定host和port:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">)),</span><span class="c1">//这里要同步读取，以免下面获取不到host和port值</span>
</span><span class='line'>  <span class="nx">host</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;接受请求:&quot;</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s2">&quot;./public&quot;</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="o">:</span><span class="s2">&quot;text/plain&quot;</span><span class="p">});</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;对不起，文件不存在!&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;获取到文件&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="o">:</span><span class="s2">&quot;text/html&quot;</span><span class="p">});</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;侦听&quot;</span> <span class="o">+</span> <span class="nx">host</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>configuration.json的内容为:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;1314&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>启动应用后，http server现在侦听的是1314端口了。如果想动态修改port并且让http server能响应?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">)),</span>
</span><span class='line'>  <span class="nx">host</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;接受请求:&quot;</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s2">&quot;./public&quot;</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="o">:</span><span class="s2">&quot;text/plain&quot;</span><span class="p">});</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;对不起，文件不存在!&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;获取到文件&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="o">:</span><span class="s2">&quot;text/html&quot;</span><span class="p">});</span>
</span><span class='line'>          <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;侦听&quot;</span> <span class="o">+</span> <span class="nx">host</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">fs</span><span class="p">.</span><span class="nx">watchFile</span><span class="p">(</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">curr</span><span class="p">,</span> <span class="nx">prev</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">//只要内容以改变，重新读取config内容</span>
</span><span class='line'>  <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nx">host</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span><span class="c1">//关闭之前的server,重新启动</span>
</span><span class='line'>  <span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;重新侦听&quot;</span> <span class="o">+</span> <span class="nx">host</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>npm介绍</h2>

<p>接下来介绍安装和更新package。访问[http://npmjs.org]http://npmjs.org。
这个网站类似于Ruby on Rails 中gem的包管理器一样。它是一个针对Node.js的包
管理器，管理Node程序之间的依赖性。使用它可以安装或者发布Node程序。</p>

<p>这里使用npm安装underscore.js(underscore.js是一个javascript工具库，使用它的函数库
可以实现类似于Prototype.js或者Ruby中的类似操作)。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="o">&gt;</span><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">underscore</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/underscore</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/underscore</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/underscore/-/underscore-1.3.3.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/underscore/-/underscore-1.3.3.tgz</span>
</span><span class='line'><span class="nx">underscore</span><span class="err">@</span><span class="mf">1.3</span><span class="p">.</span><span class="mi">3</span> <span class="nx">node_modules</span><span class="o">/</span><span class="nx">underscore</span>
</span></code></pre></td></tr></table></div></figure>


<p>安装完成以后会发现在项目目录中创建了一个node_modules文件夹，里面是安装了的node程序。
也可以全局安装npm程序,那么安装完成后，将不会在项目目录下创建新的文件夹目录。任何node程序
都可以require安装的程序。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="o">&gt;</span><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">underscore</span> <span class="o">-</span><span class="nx">g</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是如果underscore.js官方更新了版本怎么办？这里只需要执行更新命令，那么响应的node程序
中引用的npm安装程序就会被更新到最新版本。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="o">&gt;</span><span class="nx">npm</span> <span class="nx">update</span> <span class="nx">underscore</span>
</span></code></pre></td></tr></table></div></figure>


<p>安装完npm程序后，可以在项目中直接引用</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">underscore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span><span class="c1">//和引用内建的模块相同</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Express介绍</h2>

<p>下面介绍使用express npm程序读取文件。Express是针对Node高性能，高层次的web开发库。
express创建Http Server是在内建http创建server的基础上增强的。这就类似于Ruby可以
开发Web应用，但是有了Rails就更加犀利，Python也可以开发web应用，但是有了Django也变得
如鱼得水。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="o">&gt;</span><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">express</span>
</span><span class='line'><span class="nx">pm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/express</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/express</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/express/-/express-3.0.0rc4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/express/-/express-3.0.0rc4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/connect/2.4.4</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/commander/0.6.1</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/range-parser/0.0.4</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/mkdirp/0.3.3</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/cookie/0.0.4</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/crc/0.2.0</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/fresh/0.1.0</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/methods/0.0.1</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/send/0.0.4</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/debug</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/range-parser/0.0.4</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/mkdirp/0.3.3</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/range-parser/-/range-parser-0.0.4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/mkdirp/-/mkdirp-0.3.3.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/cookie/0.0.4</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/cookie/-/cookie-0.0.4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/commander/0.6.1</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/commander/-/commander-0.6.1.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/crc/0.2.0</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/fresh/0.1.0</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/crc/-/crc-0.2.0.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/fresh/-/fresh-0.1.0.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/methods/0.0.1</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/methods/-/methods-0.0.1.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/range-parser/-/range-parser-0.0.4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/mkdirp/-/mkdirp-0.3.3.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/send/0.0.4</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/send/-/send-0.0.4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/debug</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/debug/-/debug-0.7.0.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/cookie/-/cookie-0.0.4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/commander/-/commander-0.6.1.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/crc/-/crc-0.2.0.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/fresh/-/fresh-0.1.0.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/connect/2.4.4</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/connect/-/connect-2.4.4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/methods/-/methods-0.0.1.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/send/-/send-0.0.4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/debug/-/debug-0.7.0.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/connect/-/connect-2.4.4.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/mime/1.2.6</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/qs/0.4.2</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/formidable/1.0.11</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/bytes/0.1.0</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/pause/0.0.1</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/pause/0.0.1</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/pause/-/pause-0.0.1.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/mime/1.2.6</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/mime/-/mime-1.2.6.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/qs/0.4.2</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/qs/-/qs-0.4.2.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/bytes/0.1.0</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/bytes/-/bytes-0.1.0.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/formidable/1.0.11</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="nx">GET</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/formidable/-/formidable-1.0.11.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/pause/-/pause-0.0.1.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/mime/-/mime-1.2.6.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/qs/-/qs-0.4.2.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/bytes/-/bytes-0.1.0.tgz</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">http</span> <span class="mi">200</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//registry.npmjs.org/formidable/-/formidable-1.0.11.tgz</span>
</span><span class='line'><span class="nx">express</span><span class="err">@</span><span class="mf">3.0</span><span class="p">.</span><span class="mi">0</span><span class="nx">rc4</span> <span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">methods</span><span class="err">@</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">1</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">fresh</span><span class="err">@</span><span class="mf">0.1</span><span class="p">.</span><span class="mi">0</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">range</span><span class="o">-</span><span class="nx">parser</span><span class="err">@</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">4</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">cookie</span><span class="err">@</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">4</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">crc</span><span class="err">@</span><span class="mf">0.2</span><span class="p">.</span><span class="mi">0</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">commander</span><span class="err">@</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">1</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">debug</span><span class="err">@</span><span class="mf">0.7</span><span class="p">.</span><span class="mi">0</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">mkdirp</span><span class="err">@</span><span class="mf">0.3</span><span class="p">.</span><span class="mi">3</span>
</span><span class='line'><span class="err">├──</span> <span class="nx">send</span><span class="err">@</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">4</span> <span class="p">(</span><span class="nx">mime</span><span class="err">@</span><span class="mf">1.2</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
</span><span class='line'><span class="err">└──</span> <span class="nx">connect</span><span class="err">@</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">4</span> <span class="p">(</span><span class="nx">pause</span><span class="err">@</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="nx">bytes</span><span class="err">@</span><span class="mf">0.1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="nx">qs</span><span class="err">@</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="nx">formidable</span><span class="err">@</span><span class="mf">1.0</span><span class="p">.</span><span class="mi">11</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面就是安装express时也安装了依赖其他的module。下面写一个简单的express web应用:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//var app = express.createServer();//http.createServer();</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">Warning: express.createServer() is deprecated, express</span>
</span><span class='line'><span class="cm">applications no longer inherit from http.Server,</span>
</span><span class='line'><span class="cm">please use:</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  var express = require(&quot;express&quot;);</span>
</span><span class='line'><span class="cm">  var app = express();</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello Express.js!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开浏览器输入http://127.0.0.1:1317界面上将显示&#8221;Hello Express.js!&#8221;。
下面让express解析静态页面:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//var app = express.createServer();//http.createServer();</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">Warning: express.createServer() is deprecated, express</span>
</span><span class='line'><span class="cm">applications no longer inherit from http.Server,</span>
</span><span class='line'><span class="cm">please use:</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  var express = require(&quot;express&quot;);</span>
</span><span class='line'><span class="cm">  var app = express();</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">);</span><span class="c1">//在访问静态页面时，可以使用根目录路由测试一下</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span><span class="c1">//使用指定目录下的静态页面</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello Express.js!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>这时在浏览器器中http://127.0.0.1:1317/hello.html将会直接显示静态html内容。这里
可以上面的做一个对比，这里不需要定义Content-type了，这就是express做为一个Node的web
开发模块的优越性，它帮你省去了一些低级操作，可以更加专注与业务层面的实现。</p>

<p>下面可以再看一下如果请求的url中的参数是可变的，express如何获取这些内容:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//var app = express.createServer();//http.createServer();</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">Warning: express.createServer() is deprecated, express</span>
</span><span class='line'><span class="cm">applications no longer inherit from http.Server,</span>
</span><span class='line'><span class="cm">please use:</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  var express = require(&quot;express&quot;);</span>
</span><span class='line'><span class="cm">  var app = express();</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">);</span><span class="c1">//在访问静态页面时，可以使用根目录路由测试一下</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span><span class="c1">//使用指定目录下的静态页面</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello Express.js!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/hello/:your_world&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">your_world</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>这时你在浏览器地址栏中输入:http://127.0.0.1:1317/hello/foobar。见面上将显示&#8221;Hello foobar&#8221;。
express在解析时，将your_world当做params中的一个key,如果你的值匹配这个key的模式，那么就是这个key
的值。</p>

<p>在看看如何做简单的查询:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//var app = express.createServer();//http.createServer();</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">Warning: express.createServer() is deprecated, express</span>
</span><span class='line'><span class="cm">applications no longer inherit from http.Server,</span>
</span><span class='line'><span class="cm">please use:</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  var express = require(&quot;express&quot;);</span>
</span><span class='line'><span class="cm">  var app = express();</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">);</span><span class="c1">//在访问静态页面时，可以使用根目录路由测试一下</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span><span class="c1">//使用指定目录下的静态页面</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello Express.js!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/hello/:your_world&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">your_world</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;1&quot;</span><span class="o">:</span><span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mi">23</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;2&quot;</span><span class="o">:</span><span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;age&quot;</span><span class="o">:</span><span class="mi">24</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/users/:id&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;user name: &quot;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;br/&gt;user age: &quot;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;The user is not existed :(&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>在浏览器中输入http://127.0.0.1:1317/users/1看看界面上显示什么。</p>

<h2>调用github API</h2>

<p>首先浏览github官方的[http://developer.github.com/v3/]API。API的访问
是基于https的，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">);</span><span class="c1">//github的请求是基于https</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="s2">&quot;XXX&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;api.github.com&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/users/&quot;</span> <span class="o">+</span> <span class="nx">username</span> <span class="o">+</span> <span class="s2">&quot;/repos&quot;</span><span class="p">,</span><span class="c1">//github给的API</span>
</span><span class='line'>  <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="c1">//https的request方法封装了很多细节，如果有兴趣可以看一下源代码</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">){</span><span class="c1">//响应返回的数据不是一次性的</span>
</span><span class='line'>      <span class="nx">str</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">response</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Github Response: &quot;</span> <span class="o">+</span> <span class="nx">str</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">request</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span><span class="c1">//必须手动结束我们的请求</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行后将会返回一大堆JSON字符串。看看你的账户相关信息:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>   <span class="nx">response</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">repos</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">json</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">repos</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span class='line'>              <span class="nx">name</span><span class="o">:</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
</span><span class='line'>              <span class="nx">description</span><span class="o">:</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">description</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Repos detail is: &quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">repos</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">repos</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">]);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们可以把这个功能封装起来，添加callback来定义我们的回调处理:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">);</span><span class="c1">//github的请求是基于https</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">getRepos</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;api.github.com&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/users/&quot;</span> <span class="o">+</span> <span class="nx">username</span> <span class="o">+</span> <span class="s2">&quot;/repos&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="c1">//https的request方法封装了很多细节，如果有兴趣可以看一下源代码</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">response</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">){</span><span class="c1">//响应返回的数据不是一次性的</span>
</span><span class='line'>          <span class="nx">str</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">response</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">repos</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">json</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">){</span>
</span><span class='line'>              <span class="nx">repos</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span class='line'>                  <span class="nx">name</span><span class="o">:</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
</span><span class='line'>                  <span class="nx">description</span><span class="o">:</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">description</span>
</span><span class='line'>              <span class="p">});</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>          <span class="nx">callback</span><span class="p">(</span><span class="nx">repos</span><span class="p">);</span>
</span><span class='line'>          
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">request</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span><span class="c1">//必须手动结束我们的请求</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">getRepos</span><span class="p">(</span><span class="s2">&quot;XXX&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repos</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Repos count is : &quot;</span><span class="o">+</span><span class="nx">repos</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>     
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">getRepos</span><span class="p">(</span><span class="s2">&quot;JeffreyWay&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repos</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;JeffreyWay Repos count is : &quot;</span><span class="o">+</span><span class="nx">repos</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>      
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>自定义Module并使用</h2>

<p>将可以复用的代码提取到单独的文件中，做为Module使用。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">print</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="s2">&quot;foobar&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">public_print</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">print</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; again&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//使用exports决定什么函数是对外公开</span>
</span><span class='line'><span class="c1">//第一个是对外的接口名，第二个是公开的函数名</span>
</span><span class='line'><span class="c1">//print是私有的，对外不可以访问</span>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">print_str</span> <span class="o">=</span> <span class="nx">public_print</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>将上面的js发布为module</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">my_module</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./my_module.js&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">my_module</span><span class="p">.</span><span class="nx">print_str</span><span class="p">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以把上面的github的访问方法封装为一个module使用。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">);</span><span class="c1">//github的请求是基于https</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">getRepos</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;api.github.com&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/users/&quot;</span> <span class="o">+</span> <span class="nx">username</span> <span class="o">+</span> <span class="s2">&quot;/repos&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="c1">//https的request方法封装了很多细节，如果有兴趣可以看一下源代码</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">response</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">){</span><span class="c1">//响应返回的数据不是一次性的</span>
</span><span class='line'>          <span class="nx">str</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">response</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">repos</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">json</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">){</span>
</span><span class='line'>              <span class="nx">repos</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span class='line'>                  <span class="nx">name</span><span class="o">:</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
</span><span class='line'>                  <span class="nx">description</span><span class="o">:</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">description</span>
</span><span class='line'>              <span class="p">});</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>          <span class="nx">callback</span><span class="p">(</span><span class="nx">repos</span><span class="p">);</span>
</span><span class='line'>          
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">request</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span><span class="c1">//必须手动结束我们的请求</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">getRepos</span> <span class="o">=</span> <span class="nx">getRepos</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">github</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./github.js&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">github</span><span class="p">.</span><span class="nx">getRepos</span><span class="p">(</span><span class="s2">&quot;JeffreyWay&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repos</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;JeffreyWay repos count is &quot;</span> <span class="o">+</span> <span class="nx">repos</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>发布node程序为npm</h2>

<p>在要发布的工程目录下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="o">&gt;</span> <span class="nx">npm</span> <span class="nx">init</span>
</span><span class='line'><span class="nx">This</span> <span class="nx">utility</span> <span class="nx">will</span> <span class="nx">walk</span> <span class="nx">you</span> <span class="nx">through</span> <span class="nx">creating</span> <span class="nx">a</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span> <span class="nx">file</span><span class="p">.</span>
</span><span class='line'><span class="nx">It</span> <span class="nx">only</span> <span class="nx">covers</span> <span class="nx">the</span> <span class="nx">most</span> <span class="nx">common</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">tries</span> <span class="nx">to</span> <span class="nx">guess</span> <span class="nx">sane</span> <span class="nx">defaults</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">See</span> <span class="err">`</span><span class="nx">npm</span> <span class="nx">help</span> <span class="nx">json</span><span class="err">`</span> <span class="k">for</span> <span class="nx">definitive</span> <span class="nx">documentation</span> <span class="nx">on</span> <span class="nx">these</span> <span class="nx">fields</span>
</span><span class='line'><span class="nx">and</span> <span class="nx">exactly</span> <span class="nx">what</span> <span class="nx">they</span> <span class="k">do</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Use</span> <span class="err">`</span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">&lt;</span><span class="nx">pkg</span><span class="o">&gt;</span> <span class="o">--</span><span class="nx">save</span><span class="err">`</span> <span class="nx">afterwards</span> <span class="nx">to</span> <span class="nx">install</span> <span class="nx">a</span> <span class="kr">package</span> <span class="nx">and</span>
</span><span class='line'><span class="nx">save</span> <span class="nx">it</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">dependency</span> <span class="k">in</span> <span class="nx">the</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span> <span class="nx">file</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Press</span> <span class="o">^</span><span class="nx">C</span> <span class="nx">at</span> <span class="nx">any</span> <span class="nx">time</span> <span class="nx">to</span> <span class="nx">quit</span><span class="p">.</span>
</span><span class='line'><span class="nx">name</span><span class="o">:</span> <span class="p">(</span><span class="nx">workspace</span><span class="p">)</span> <span class="nx">todo</span><span class="o">-</span><span class="nx">github</span><span class="o">-</span><span class="nx">example</span>
</span><span class='line'><span class="nx">version</span><span class="o">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="mf">0.0</span><span class="p">.</span><span class="mi">1</span>
</span><span class='line'><span class="nx">description</span><span class="o">:</span> <span class="kr">export</span> <span class="nx">github</span> <span class="nx">api</span> <span class="k">for</span> <span class="nx">node</span>
</span><span class='line'><span class="nx">entry</span> <span class="nx">point</span><span class="o">:</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">js</span><span class="p">)</span> <span class="nx">github</span><span class="p">.</span><span class="nx">js</span>
</span><span class='line'><span class="nx">test</span> <span class="nx">command</span><span class="o">:</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">repository</span><span class="o">:</span>
</span><span class='line'><span class="nx">keywords</span><span class="o">:</span> <span class="nx">github</span> <span class="nx">get</span> <span class="nx">user</span><span class="s1">&#39;s repos api</span>
</span><span class='line'><span class="s1">author: todo</span>
</span><span class='line'><span class="s1">license: (BSD) BSD</span>
</span><span class='line'><span class="s1">About to write to /Users/XXX/Node/workspace/package.json:</span>
</span><span class='line'>
</span><span class='line'><span class="s1">{</span>
</span><span class='line'><span class="s1">  &quot;name&quot;: &quot;todo-github-example&quot;,</span>
</span><span class='line'><span class="s1">  &quot;version&quot;: &quot;0.0.1&quot;,</span>
</span><span class='line'><span class="s1">  &quot;description&quot;: &quot;export github api for node&quot;,</span>
</span><span class='line'><span class="s1">  &quot;main&quot;: &quot;github.js&quot;,</span>
</span><span class='line'><span class="s1">  &quot;dependencies&quot;: {</span>
</span><span class='line'><span class="s1">    &quot;express&quot;: &quot;~3.0.0rc4&quot;,</span>
</span><span class='line'><span class="s1">    &quot;underscore&quot;: &quot;~1.3.3&quot;</span>
</span><span class='line'><span class="s1">  },</span>
</span><span class='line'><span class="s1">  &quot;devDependencies&quot;: {},</span>
</span><span class='line'><span class="s1">  &quot;scripts&quot;: {</span>
</span><span class='line'><span class="s1">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
</span><span class='line'><span class="s1">  },</span>
</span><span class='line'><span class="s1">  &quot;keywords&quot;: [</span>
</span><span class='line'><span class="s1">    &quot;github&quot;,</span>
</span><span class='line'><span class="s1">    &quot;get&quot;,</span>
</span><span class='line'><span class="s1">    &quot;user&#39;</span><span class="nx">s</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    &quot;</span><span class="nx">repos</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    &quot;</span><span class="nx">api</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">  ],</span>
</span><span class='line'><span class="s2">  &quot;</span><span class="nx">author</span><span class="s2">&quot;: &quot;</span><span class="nx">todo</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">  &quot;</span><span class="nx">license</span><span class="s2">&quot;: &quot;</span><span class="nx">BSD</span><span class="err">&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">Is</span> <span class="k">this</span> <span class="nx">ok</span><span class="o">?</span> <span class="p">(</span><span class="nx">yes</span><span class="p">)</span> <span class="nx">yes</span>
</span></code></pre></td></tr></table></div></figure>


<p>输入相关信息后会在工作目录中生成一个package.json,内容如下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;todo-github-example&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;export github api for node&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;github.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;express&quot;</span><span class="p">:</span> <span class="s2">&quot;~3.0.0rc4&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;underscore&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.3.3&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span class='line'>  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;keywords&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="s2">&quot;github&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;get&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;user&#39;s&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;repos&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;api&quot;</span>
</span><span class='line'>  <span class="p">],</span>
</span><span class='line'>  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;todo&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;BSD&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>接下来是使用npm连接官网，登陆</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">$&gt;npm</span> <span class="err">adduser</span>
</span></code></pre></td></tr></table></div></figure>


<p>发布todo-github-example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">$&gt;npm</span> <span class="err">publish</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后到https://npmjs.org/去查找刚才提交的npm程序。如果我们需要修改文件
准备发布下一个版本时，只要修改package.json中的版本信息后，再次publish
即可。使用方法在上面的npm安装程序中已经阐述过。</p>

<h2>MongoDB与Node结合</h2>

<p>下面介绍使用Node对MongoDB数据库进行插入和查询操作，以及和Web Service的结合。
首先到MongoDB的官方网站下载适合的安装文件并安装，在这里介绍的是Node和MongoDB
的结合，所以还需要安装mongodb的npm安装程序。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">$&gt;</span> <span class="err">npm</span> <span class="err">install</span> <span class="err">mongodb</span>
</span></code></pre></td></tr></table></div></figure>


<p>Mongodb使用的是类似于json的bson数据格式存储数据。它是经过编码的二进制数据，读取
的效率一般要高于传统的关系型数据库，缺点是难于表述表与表之间的关联。详细的介绍可以
查阅相关的资料，这里就不再叙述。</p>

<p>下面实现连接mongdb数据库</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mongodb&quot;</span><span class="p">);</span><span class="c1">//相当于引用Mongodb这个对象</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">mongo</span><span class="p">.</span><span class="nx">Connection</span><span class="p">.</span><span class="nx">DEFAULT_PORT</span><span class="p">;</span><span class="c1">//使用mongodb的默认端口</span>
</span><span class='line'><span class="c1">//创建一个连接和创建数据库nodejs_intro</span>
</span><span class='line'><span class="c1">//这和一般地连接MySQL数据库类似</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongo</span><span class="p">.</span><span class="nx">Db</span><span class="p">(</span><span class="s2">&quot;nodejs_intro&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">mongo</span><span class="p">.</span><span class="nx">Server</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="p">,{}));</span>
</span><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span><span class="c1">//如果连接失败，或者server有问题，将会获得error</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;We have connected to &quot;</span> <span class="o">+</span> <span class="nx">host</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>[TODO]</p>

<h2>Real Time APP与Node</h2>

<p>下面将要介绍的是实时存储数据，以及使用socket.io将数据streaming化并显示到浏览器上。</p>

<p>首先要创建一个web server，第二个是有一个数据源供读写，最后是使用socket.io将读取
的数据streaming化。</p>

<p>[TODO]</p>

<ul>
<li><p>[http://nodejs.org]Node官网</p></li>
<li><p>[http://twitter.com/#!/nodejs]Node Twitter</p></li>
<li><p>[http://www.mongodb.org]MongoDB官网</p></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dong</span></span>

      








  


<time datetime="2012-09-16T19:51:00+08:00" pubdate data-updated="true">Sep 16<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/node-js/'>Node.js</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    
    <section>
      <h1>Comments</h1>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
    
    <ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="/blog/2012/09/15/rspec-basic/" title="Previous Post:
        Rspec基础">&laquo; Rspec基础</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
      <li class="next"><a class="basic-alignment right" href="/blog/2012/09/21/python-simple-tutorial/"
        title="Next Post: Python简明教程">Python简明教程
        &raquo;</a></li>
      
    </ul>
  </footer>
</article>

<aside class="sidebar-nav span3">
  
    <section class="well">
 <h1>标签</h1>
 <ul id="categories">
 <li class='category'><a href=' /blog/categories/backbone-js/'>Backbone.js (1)</a></li>
<li class='category'><a href=' /blog/categories/getting-real记/'>Getting Real记 (2)</a></li>
<li class='category'><a href=' /blog/categories/git/'>Git (3)</a></li>
<li class='category'><a href=' /blog/categories/javascript/'>JavaScript (11)</a></li>
<li class='category'><a href=' /blog/categories/node-js/'>Node.js (2)</a></li>
<li class='category'><a href=' /blog/categories/octopress/'>Octopress (2)</a></li>
<li class='category'><a href=' /blog/categories/programming/'>Programming (1)</a></li>
<li class='category'><a href=' /blog/categories/python/'>Python (1)</a></li>
<li class='category'><a href=' /blog/categories/rspec/'>Rspec (1)</a></li>
<li class='category'><a href=' /blog/categories/jquery/'>jQuery (1)</a></li>
<li class='category'><a href=' /blog/categories/其它/'>其它 (1)</a></li>
<li class='category'><a href=' /blog/categories/安装/'>安装 (3)</a></li>
<li class='category'><a href=' /blog/categories/配置/'>配置 (4)</a></li>

 </ul>
</section>
<section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">Recent Posts</li>
    
      <li class="post">
        <a href="/blog/2013/03/10/disqus-not-visible-in-octopress/">Disqus 评论功能无法显示</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/26/how-to-create-jquery-plugin/">如何创建一个jQuery插件</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/29/javascript-ten-mistakes/">JavaScript十宗罪</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/15/intro-backbone-view/">Backbone.js之View介绍</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/26/add-new-page-in-octopress/">Add new page in Octopress</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2013 - Dong -
  <span class="credit">Powered by <a href="http://dongtong.github.com">ME</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dong-way';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.dongjinhu.com/blog/2012/09/16/introduce-nodejs/';
        var disqus_url = 'http://www.dongjinhu.com/blog/2012/09/16/introduce-nodejs/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
